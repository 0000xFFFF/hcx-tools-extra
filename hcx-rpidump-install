#!/usr/bin/env bash

# Ensure script runs as root
if [[ $EUID -ne 0 ]]; then
    echo "Please run this script as root (use sudo)"
    exit 1
fi

PROGRAM_NAME="hcx-rpidump"
PROGRAM_PATH="/usr/local/bin/$PROGRAM_NAME"
SERVICE_FILE="/etc/systemd/system/$PROGRAM_NAME.service"

echo "Setting up systemd service..."

cat <<EOF > "$SERVICE_FILE"
[Unit]
Description=$PROGRAM_NAME Service
After=network.target

[Service]
ExecStart=$PROGRAM_PATH
WorkingDirectory=/usr/local/bin
StandardOutput=inherit
StandardError=inherit
Restart=always
User=root

[Install]
WantedBy=multi-user.target
EOF

echo "Enabling and starting service..."
systemctl daemon-reload
systemctl enable "$PROGRAM_NAME"
systemctl start "$PROGRAM_NAME"

echo "Installation complete! $PROGRAM_NAME is now running at startup."
